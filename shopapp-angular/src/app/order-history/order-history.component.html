<div class="page-wrapper">
  <app-header></app-header>

  <div class="order-history-container">
    <h1>Lịch sử đặt hàng</h1>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Đang tải lịch sử đặt hàng...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="error-state">
      <i class="fas fa-exclamation-circle"></i>
      <p>{{ error }}</p>
    </div>

    <!-- Orders List -->
    <div *ngIf="!loading && !error" class="orders-list">
      <div *ngIf="orders.length === 0" class="no-orders">
        <i class="fas fa-shopping-bag"></i>
        <p>Bạn chưa có đơn hàng nào</p>
        <a routerLink="/" class="btn-primary">Tiếp tục mua sắm</a>
      </div>

      <div *ngFor="let order of orders" class="order-card">
        <div class="order-header">
          <div class="order-info">
            <h3>Đơn hàng #{{ order.id }}</h3>
            <p class="order-code">Mã đơn: <b>{{ order.order_code }}</b></p>
            <p class="order-date">{{ order.createdAt | date:'dd/MM/yyyy HH:mm' }}</p>
          </div>
          <div class="order-status" [ngClass]="getStatusClass(order.status)">
            {{ getStatusLabel(order.status) }}
          </div>
          <button class="btn btn-danger" *ngIf="order.status !== 'Đã hủy'" (click)="cancelOrder(order.id!)">
            Hủy đơn
          </button>
        </div>

        <div class="order-items">
          <div *ngFor="let item of order.items" class="order-item">
            <div class="product-image">
              <img [src]="'http://localhost:3000/uploads/' + item.product.image"
                   [alt]="item.product.name"
                   (error)="item.product.image = 'assets/images/default-product.jpg'">
            </div>
            <div class="item-details">
              <h4>{{ item.product.name }}</h4>
              <div class="item-price-quantity">
                <p class="item-price">{{ item.product.price | number }} VNĐ</p>
                <p class="item-quantity">Số lượng: {{ item.quantity }}</p>
              </div>
              <p class="item-total">Thành tiền: {{ item.getTotalPrice() | number }} VNĐ</p>
            </div>
          </div>
        </div>

        <div class="order-footer">
          <div class="order-total">
            <span>Tổng tiền đơn hàng:</span>
            <strong>{{ order.total_price | number }} VNĐ</strong>
          </div>
        </div>
      </div>
    </div>
  </div>

  <app-footer></app-footer>
</div>
