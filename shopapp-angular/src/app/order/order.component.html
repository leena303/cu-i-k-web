<app-header></app-header>
<div class="container">
  <div class="intro-section">
    <h1>Xác nhận đơn hàng</h1>
    <p>Kiểm tra lại giỏ hàng và tiến hành đặt hàng</p>
  </div>

  <!-- Cart and Order Form - Shown when orderPlaced is false -->
  <div class="row" *ngIf="!orderPlaced">
    <div class="col-md-12">
      <table class="table">
        <thead>
          <tr>
            <th scope="col" class="text-start">Sản phẩm</th>
            <th scope="col">Số lượng</th>
            <th scope="col">Đơn giá</th>
            <th scope="col">Tổng giá</th>
            <th scope="col">Xóa</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of cartItems">
            <td>
              <div class="product-info">
                <img [src]="item.product.getFullImageUrl()"
                     [alt]="item.product.name"
                     class="product-image-order"
                     (error)="item.product.image = item.product.getDefaultImage()">
                <span class="product-name-order">{{item.product.name}}</span>
              </div>
            </td>
            <td>
              <div class="quantity-controls">
                <button class="btn btn-sm btn-outline-secondary" 
                        (click)="updateQuantity(item.product.id, item.quantity - 1)"
                        [disabled]="item.quantity <= 1">-</button>
                <span class="mx-2">{{item.quantity}}</span>
                <button class="btn btn-sm btn-outline-secondary"
                        (click)="updateQuantity(item.product.id, item.quantity + 1)">+</button>
              </div>
            </td>
            <td>{{item.product.getFormattedPrice()}}</td>
            <td>{{item.getFormattedTotalPrice()}}</td>
            <td>
              <button class="btn btn-danger btn-sm" (click)="removeItem(item.product.id)">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="text-end mt-3">
        <h4>Tổng cộng: {{totalAmount | number }} VNĐ</h4>
      </div>

      <!-- Detailed Order Summary -->
      <div class="order-summary mt-4">
        <h4 class="product-header">Tóm tắt đơn hàng</h4>
        <div class="summary-item">
          <span>Tổng phụ:</span>
          <span>{{ totalAmount | number }} VNĐ</span> <!-- totalAmount is currently subtotal -->
        </div>
        <!-- Discount Row (conditionally displayed if coupon applied) -->
        <div class="summary-item" *ngIf="discountAmount > 0">
          <span>Giảm giá:</span>
          <span>- {{ discountAmount | number }} VNĐ</span>
        </div>
        <!-- Shipping Cost Row (placeholder) -->
        <div class="summary-item">
          <span>Phí vận chuyển:</span>
          <span>{{ shippingCost | number }} VNĐ</span> <!-- Placeholder for shipping cost -->
        </div>
        <div class="summary-divider"></div>
        <div class="summary-item total">
          <span>Tổng cộng:</span>
          <span>{{ finalTotalAmount | number }} VNĐ</span> <!-- Final calculated total -->
        </div>
      </div>

      <!-- Shipping Information Section -->
      <div class="shipping-info mt-4">
        <h4 class="product-header">Thông tin giao hàng</h4>
        <div class="form-group">
          <label for="shippingName" class="form-label">Họ tên người nhận</label>
          <input type="text" class="form-control" id="shippingName" [(ngModel)]="shipping_name" required>
        </div>
        <div class="form-group mt-3">
          <label for="shippingPhone" class="form-label">Số điện thoại</label>
          <input type="tel" class="form-control" id="shippingPhone" [(ngModel)]="shipping_phone" required>
        </div>
        <div class="form-group mt-3">
          <label for="shippingAddress" class="form-label">Địa chỉ nhận hàng</label>
          <textarea class="form-control" id="shippingAddress" [(ngModel)]="shipping_address" rows="3" required></textarea>
        </div>
        <!-- TODO: Add fields for City, District, etc. if needed -->
      </div>

      <!-- Payment Method Section -->
      <div class="payment-method mt-4">
        <h4 class="product-header">Phương thức thanh toán</h4>
        <div class="form-group">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="paymentMethod" id="codPayment" value="COD" [(ngModel)]="selectedPaymentMethod">
            <label class="form-check-label" for="codPayment">
              Thanh toán khi nhận hàng (COD)
            </label>
          </div>
          <!-- Add other payment methods here if needed -->
          <!-- Example: Bank Transfer -->
          <!--
          <div class="form-check mt-2">
            <input class="form-check-input" type="radio" name="paymentMethod" id="bankTransferPayment" value="Bank Transfer" [(ngModel)]="selectedPaymentMethod">
            <label class="form-check-label" for="bankTransferPayment">
              Chuyển khoản ngân hàng
            </label>
          </div>
          -->
        </div>
      </div>

      <div class="mt-3">
        <h4 class="product-header">Nhập coupon (Tùy chọn)</h4>
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Nhập coupon" [(ngModel)]="couponCode">
          <button class="btn btn-gradient" type="button">Áp dụng</button>
        </div>
      </div>

      <!-- Terms and Conditions Checkbox -->
      <div class="form-group mt-3 form-check">
        <input type="checkbox" class="form-check-input" id="agreeTerms" [(ngModel)]="agreeTerms" required>
        <label class="form-check-label" for="agreeTerms">
          Tôi đồng ý với các điều khoản và điều kiện
        </label>
        <!-- TODO: Add a link to the actual terms and conditions page -->
      </div>

      <div class="text-center mt-4">
        <button class="btn btn-gradient" type="button" (click)="placeOrder()" [disabled]="!isOrderValid">Đặt hàng</button>
      </div>
    </div>
  </div>

  <!-- Order Successful Message - Shown when orderPlaced is true -->
  <div class="row text-center" *ngIf="orderPlaced">
    <div class="col-md-12">
      <div class="order-success-message mt-5">
        <h2><i class="fas fa-check-circle text-success"></i> Đặt hàng thành công!</h2>
        <p>Cảm ơn bạn đã đặt hàng của chúng tôi.</p>
        <p>Bạn có thể xem lại đơn hàng của mình trong lịch sử đặt hàng.</p>
        <a class="btn btn-info me-3" (click)="viewOrderHistory()">Xem lịch sử đặt hàng</a>
        <button class="btn btn-primary" (click)="continueShopping()">Tiếp tục mua sắm</button>
      </div>
    </div>
  </div>

</div>
<app-footer></app-footer>
